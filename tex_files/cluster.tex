\section{Clustering (20 points)}

Download the image \texttt{mandrill.png} from Canvas. In this problem you will apply the $k$-means algorithm to image compression. In this context it is also known as the Lloyd-Max algorithm.

\begin{problem}
First, partition the image into blocks of size $M \times M$ and
reshape each block into a vector of length $3M^2$  (see \texttt{q2\_starter.py}). The 3 comes from the fact that this is a color image, and so there are three intensities for each pixel. Assume that $M$, like the image dimensions, is a power of 2.

Next, write a program that will cluster the vectors from \textbf{Problem 3} using the $k$-means algorithm.
\textbf{You should implement the $k$-means algorithm yourself.} Please initialize the cluster means to be randomly selected data points, sampled without replacement.

Finally, reconstruct a quantized version of the original image by
replacing each block in the original image by the nearest centroid. Test your code using $M = 2$ and $k = 64$.

\emph{Deliverables:}
\begin{itemize}
    \item A plot of the $k$-means objective function value versus iteration number.
    \item A description of how the compressed image looks compared to the original. What regions are best preserved, and which are not?
    \item A picture of the difference of the two images. You should add a neutral gray $(128,128,128)$ to the difference before generating the image.
    \item The compression ratio (use your forumla from \textbf{problem 4}).
    \item The
relative mean absolute error of the compressed image, defined as
\[
\frac{\frac{1}{3N^2} \sum_{i=1}^N \sum_{j=1}^N \sum_{r=1}^3 |\tilde{I}(i, j, r) - I(i, j, r)|}{255}
\]
where $\tilde{I}$ and $I$ are the compressed and original images, respectively, viewed as 3-D arrays. This
quantity can be viewed as the average error in pixel intensity relative to the range of
pixel intensities.
    \item Please submit you code, as usual.
\end{itemize}
\end{problem}

\begin{problem}
The original uncompressed image uses 24 bits per pixel (bpp), 8 bits for each
color. Assuming an image of size $N \times N$, where $N$ is a power of 2, what is the number
of bits per pixel, as a function of $M$, $N$, and $k$, needed to store the compressed image?
What is the compression ratio, which is defined as the ratio of bpp in the compressed
image relative to the original uncompressed image? \emph{Hint: To calculate the bpp of the
compressed image, imagine you need to transmit the compressed image to a friend who
knows the compression strategy as well as the values of $M$, $N$, and $k$.}
\end{problem}

\begin{problem}
(Optional, ungraded) Play around with $M$ and $k$.
\end{problem}
